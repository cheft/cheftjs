(function(){var t=[].slice;!function(t,r){var e;return"function"==typeof define&&define.amd?define(["riot"],function(e){return r(t,e)}):"object"==typeof exports?(e=require("riot"),module.exports=r(t,e)):t.Cheft=r(t,t.riot)}(window,function(r,e){var n,o,i,u,s,p,a,c,l,h,f,d,g,y,m,x,v,j;for(n=o={version:"1.2.0"},n.riot=e,v=Object.prototype.toString,j=["Function","Object","String","Array","Number","Boolean","Date","RegExp","Undefined","Null"],c=function(t){return n["is"+t]=function(r){return v.call(r)==="[object "+t+"]"}},l=0,f=j.length;f>l;l++)h=j[l],c(h);return n.extend=function(){var r,e,n,o,i,u,s;if(u=arguments[0],i=2<=arguments.length?t.call(arguments,1):[],!u)return u;for(r=0,n=i.length;n>r;r++){o=i[r];for(e in o)s=o[e],u[e]=s}return u},n.Application=s=function(){function t(t){this.options=null!=t?t:{},this.urlRoot=this.options.urlRoot||"",this.contentType=this.options.contentType||"application/x-www-form-urlencoded",this.router=new n.Router(this.options.router),e.observable(this)}return t.prototype.start=function(){return this.container=this.mount(this.options.container),this.router.start()},t.prototype.mount=function(t){var r;return this.tags=this.tags||{},r=e.mount(t)[0],this.tags[t]=r,this.currentTag=r,r},t.prototype.mixin=function(t,r){var e,o,i;if(o=function(){},r.on){o=r.on.init||function(){},e=function(e){return t.on(e,r.on[e])};for(h in r.on)e(h)}return r["do"]&&(r["do"].init=o,t.mixin(r["do"])),r.store?(i={},n.isString(r.store)?i.url=r.store:n.isObject(r.store)&&(i=r.store),t.store=new u(app,t,i)):void 0},t}(),g=/\((.*?)\)/g,d=/(\(\?)?:\w+/g,x=/\*\w+/g,p=/[\-{}\[\]+?.,\\\^$|#\s]/g,y=function(t){return t=t.replace(p,"\\$&").replace(g,"(?:$1)?").replace(d,function(t,r){return r?t:"([^/?]+)"}).replace(x,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},a=function(t,r){var e,n,o,i,u;for(i=t.exec(r).slice(1),u=[],e=0,n=i.length;n>e;e++)o=i[e],u.push(decodeURIComponent(o)||null);return u},m=function(t,r){var e,o,i,u,s,p,c;e=t.opts,c=e.routes,o=r.join("/"),s=[];for(i in c)p=y(i),p.test(o)&&(n.isFunction(c[i])?s.push(c[i].apply(t,a(p,o))):s.push(null!=(u=e[c[i]])?u.apply(t,a(p,o)):void 0));return s},n.Router=i=function(){function r(t){this.opts=t}return r.prototype.start=function(){return e.route.exec(function(r){return function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],m(r,e)}}(this)),e.route(function(r){return function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],m(r,e)}}(this)),e.route.start()},r.prototype.stop=function(){return e.route.stop()},r.prototype.go=function(t){return e.route(t)},r.prototype.back=function(){return history.back()},r.prototype.add=function(t,r){return this.opts.routes[t]=r},r.prototype.remove=function(t){return delete this.opts.routes[t]},r}(),n.Adapter={Promise:{},ajax:{}},n.Store=u=function(){function t(t,r,e){this.app=t,this.tag=r,this.options=e,this.url=this.options.url,this.data=this.options.data||{},this.params=this.options.params||{},delete this.options.url,delete this.options.data,delete this.options.params}return t.prototype.get=function(t){return null==t&&(t={}),this.ajax({type:"GET",url:t.id?this.url+"/"+t.id:this.url},t,"geted")},t.prototype.post=function(t){return null==t&&(t={}),this.ajax({type:"POST",url:this.url},t,"posted")},t.prototype.put=function(t){return null==t&&(t={}),this.ajax({type:"PUT",url:this.url+"/"+t.id},t,"puted")},t.prototype.del=function(t){return null==t&&(t={}),this.ajax({type:"DELETE",url:this.url+"/"+t.id},t,"deleted")},t.prototype.save=function(t){return null==t&&(t={}),t.id?this.put(t):this.post(t)},t.prototype.ajax=function(t,r,e){var o,i,u,s;s=this,t.contentType=this.app.contentType,i=n.extend(t,this.options),i.url=this.app.urlRoot+i.url,o="";for(u in this.params)o+=u+"="+this.params[u]+"&";return""!==o&&(i.url+="?"+o.substring(0,o.length-1)),i.data=r,this.app.trigger("ajax",i),u=new n.Adapter.Promise,n.Adapter.ajax(i).done(function(t){return"geted"===e&&s.set(t),s.tag.trigger(e,t,"success"),("posted"===e||"puted"===e)&&s.tag.trigger("saved",t,"success"),s.app.trigger("ajaxed",t,"success"),u.resolve(t)}).fail(function(t){return s.tag.trigger(e,t,"error"),("posted"===e||"puted"===e)&&s.tag.trigger("saved",t,"error"),s.app.trigger("ajaxed",t,"error"),u.reject(t)}),u.promise()},t.prototype.set=function(t){return this.data=this.options.root?t[this.options.root]:t,this},t.prototype.clear=function(){return this.data={},this},t}(),o})}).call(this);