(function(){var t=[].slice;!function(t,r){var n;return"function"==typeof define&&define.amd?define(["riot"],function(n){return r(t,n)}):"object"==typeof exports?(n=require("riot"),module.exports=r(t,n)):t.Cheft=r(t,t.riot)}(window,function(r,n){var e,o,i,u,s,a,p,c,f,l,h,g,d,y,m,v,x,j;for(e=o={version:"1.0.0"},x=Object.prototype.toString,j=["Function","Object","String","Array","Number","Boolean","Date","RegExp","Undefined","Null"],c=function(t){return e["is"+t]=function(r){return x.call(r)==="[object "+t+"]"}},f=0,h=j.length;h>f;f++)l=j[f],c(l);return e.extend=function(){var r,n,e,o,i,u,s;if(u=arguments[0],i=2<=arguments.length?t.call(arguments,1):[],!u)return u;for(r=0,e=i.length;e>r;r++){o=i[r];for(n in o)s=o[n],u[n]=s}return u},e.Application=s=function(){function t(t){this.options=null!=t?t:{},this.urlRoot=this.options.urlRoot||""}return t.prototype.mount=function(t){var r;return this.tags=this.tags||{},r=n.mount(t)[0],this.tags[t]=r,this.currentTag=r},t.prototype.mixin=function(t,r){var n,o,i;if(o=function(){},r.events){o=r.events.init||function(){},n=function(n){return t.on(n,r.events[n])};for(l in r.events)n(l)}return r.actions&&(r.actions.init=o,t.mixin(r.actions)),r.store?(i={},e.isString(r.store)?i.url=r.store:e.isObject(r.store)&&(i=r.store),t.store=new u(app,t,i)):void 0},t}(),d=/\((.*?)\)/g,g=/(\(\?)?:\w+/g,v=/\*\w+/g,a=/[\-{}\[\]+?.,\\\^$|#\s]/g,y=function(t){return t=t.replace(a,"\\$&").replace(d,"(?:$1)?").replace(g,function(t,r){return r?t:"([^/?]+)"}).replace(v,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},p=function(t,r){var n,e,o,i,u;for(i=t.exec(r).slice(1),u=[],n=0,e=i.length;e>n;n++)o=i[n],u.push(decodeURIComponent(o)||null);return u},m=function(t,r){var n,o,i,u,s,a,c;n=t.opts,c=n.routes,o=r.join("/"),s=[];for(i in c)a=y(i),a.test(o)&&s.push(e.isFunction(c[i])?c[i].apply(t,p(a,o)):null!=(u=n[c[i]])?u.apply(t,p(a,o)):void 0);return s},e.Router=i=function(){function r(t){this.opts=t}return r.prototype.start=function(){return n.route.exec(function(r){return function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],m(r,n)}}(this)),n.route(function(r){return function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],m(r,n)}}(this)),n.route.start()},r.prototype.stop=function(){return n.route.stop()},r.prototype.go=function(t){return n.route(t)},r.prototype.back=function(){return history.back()},r.prototype.add=function(t,r){return this.opts.routes[t]=r},r.prototype.remove=function(t){return delete this.opts.routes[t]},r}(),e.Adapter={Promise:{},ajax:{}},e.Store=u=function(){function t(t,r,n){this.app=t,this.tag=r,this.options=n,this.params=this.options.params||{},this.url=this.options.url,this.data=this.options.data||{}}return t.prototype.getParams=function(){return this.params},t.prototype.get=function(t){return this.ajax({type:"GET",url:this.url},t,"geted")},t.prototype.post=function(t){return this.ajax({type:"POST",url:this.url},t,"posted")},t.prototype.put=function(t){return this.ajax({type:"PUT",url:this.url+"/"+t.id},t,"puted")},t.prototype.del=function(t){return this.ajax({type:"DELETE",url:this.url+"/"+t.id},t,"deleted")},t.prototype.save=function(t){return this.data.id?this.put(t):this.post(t)},t.prototype.ajax=function(t,r,n){var o,i;return null==r&&(r={}),i=this,t.url=this.app.urlRoot+t.url,t.data=r,o=new e.Adapter.Promise,e.Adapter.ajax(t).done(function(t){return i.set(t),i.tag.trigger(n,"success",t),"posted"===n&&i.tag.trigger("saved","success",t),o.resolve(t)}).fail(function(t){return i.tag.trigger(n,"error",t),"posted"===n&&i.tag.trigger("saved","error",t),o.reject(t)}),o.promise()},t.prototype.set=function(t){return this.data=this.options.root?t[this.options.root]:t,this},t.prototype.clear=function(t){return this.data={},this},t}(),o})}).call(this);