(function(){var t=[].slice;!function(t,n){var r;return"function"==typeof define&&define.amd?define(["riot"],function(r){return n(t,r)}):"object"==typeof exports?(r=require("riot"),module.exports=n(t,r)):t.Cheft=n(t,t.riot)}(window,function(n,r){var e,o,i,u,s,a,p,c,f,h,l,g,y,d,m,v,x,j,S,b;for(e=i={version:"1.0.0"},l=0,S=Object.prototype.toString,b=["Function","Object","String","Array","Number","Boolean","Date","RegExp","Undefined","Null"],f=function(t){return e["is"+t]=function(n){return S.call(n)==="[object "+t+"]"}},h=0,y=b.length;y>h;h++)g=b[h],f(g);return e.extend=function(){var n,r,e,o,i,u,s;if(u=arguments[0],i=2<=arguments.length?t.call(arguments,1):[],!u)return u;for(n=0,e=i.length;e>n;n++){o=i[n];for(r in o)s=o[r],u[r]=s}return u},e.uniqueId=function(t){return(t?t:"")+ ++l},e.Application=a=function(){function t(t){this.options=null!=t?t:{},this.urlRoot=this.options.urlRoot||""}return t.prototype.mount=function(t){var n;return this.tags=this.tags||{},n=r.mount(t)[0],this.tags[t]=n,this.currentTag=n},t.prototype.mixin=function(t,n){var r,o,i;if(n.actions&&t.mixin(n.actions),n.events){r=function(r){return t.on(r,n.events[r])};for(g in n.events)r(g)}if(n.stores){i={};for(g in n.stores)n.stores[g].url=n.stores[g].url||g,o=new s(app,t,n.stores[g]),i[g]=o;return e.extend(t,i)}},t}(),m=/\((.*?)\)/g,d=/(\(\?)?:\w+/g,j=/\*\w+/g,p=/[\-{}\[\]+?.,\\\^$|#\s]/g,v=function(t){return t=t.replace(p,"\\$&").replace(m,"(?:$1)?").replace(d,function(t,n){return n?t:"([^/?]+)"}).replace(j,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},c=function(t,n){var r,e,o,i,u;for(i=t.exec(n).slice(1),u=[],r=0,e=i.length;e>r;r++)o=i[r],u.push(decodeURIComponent(o)||null);return u},x=function(t,n){var r,o,i,u,s,a,p;r=t.opts,p=r.routes,o=n.join("/"),s=[];for(i in p)a=v(i),a.test(o)&&s.push(e.isFunction(p[i])?p[i].apply(t,c(a,o)):null!=(u=r[p[i]])?u.apply(t,c(a,o)):void 0);return s},e.Router=u=function(){function n(t){this.opts=t}return n.prototype.start=function(){return r.route.exec(function(n){return function(){var r;return r=1<=arguments.length?t.call(arguments,0):[],x(n,r)}}(this)),r.route(function(n){return function(){var r;return r=1<=arguments.length?t.call(arguments,0):[],x(n,r)}}(this)),r.route.start()},n.prototype.stop=function(){return r.route.stop()},n.prototype.go=function(t){return r.route(t)},n.prototype.back=function(){return history.back()},n.prototype.add=function(t,n){return this.opts.routes[t]=n},n.prototype.remove=function(t){return delete this.opts.routes[t]},n}(),e.Adapter={Promise:{},ajax:{}},e.Store=s=function(){function t(t,n,r){this.app=t,this.tag=n,this.options=r,this.params=e.extend({},this.options.params),this.url=this.options.url,this.data=this.options.data||{}}return t.prototype.getParams=function(){return this.params},t.prototype.get=function(t){var n;return n=new e.Adapter.Promise,this.ajax({type:"GET",url:this.url},t).done(function(t){return function(r){return t.set(r),n.resolve(r)}}(this)).fail(function(t){return n.reject(t)}),n.promise()},t.prototype.post=function(t){return this.ajax({type:"POST",url:this.url},t)},t.prototype.put=function(t){return this.ajax({type:"PUT",url:this.url+"/"+t.id},t)},t.prototype.del=function(t){return this.ajax({type:"DELETE",url:this.url+"/"+t.id},t)},t.prototype.save=function(t){return this.data.id?this.put(t):this.post(t)},t.prototype.ajax=function(t,n){return null==n&&(n={}),t.url=this.app.urlRoot+t.url,t.data=n,e.Adapter.ajax(t)},t.prototype.set=function(t){return this.data=this.options.root?t[this.options.root]:t,this},t.prototype.clear=function(t){return this.data={},this},t}(),e.Cache=o=function(){function t(t,n){this.key=t,this.session=n,this.cache=localStorage,this.session&&(this.cache=sessionStorage)}return t.prototype.get=function(){return JSON.parse(this.cache.getItem(this.key)||"[]")},t.prototype.save=function(t){return this.cache.setItem(this.key,JSON.stringify(t))},t}(),i})}).call(this);