(function(){var t=[].slice;!function(t,r){var e;return"function"==typeof define&&define.amd?define(["riot"],function(e){return r(t,e)}):"object"==typeof exports?(e=require("riot"),module.exports=r(t,e)):t.Cheft=r(t,t.riot)}(window,function(r,e){var n,o,i,s,u,p,a,c,h,l,f,g,d,y,m,v,x,j;for(n=o={version:"1.0.0"},n.riot=e,x=Object.prototype.toString,j=["Function","Object","String","Array","Number","Boolean","Date","RegExp","Undefined","Null"],c=function(t){return n["is"+t]=function(r){return x.call(r)==="[object "+t+"]"}},h=0,f=j.length;f>h;h++)l=j[h],c(l);return n.extend=function(){var r,e,n,o,i,s,u;if(s=arguments[0],i=2<=arguments.length?t.call(arguments,1):[],!s)return s;for(r=0,n=i.length;n>r;r++){o=i[r];for(e in o)u=o[e],s[e]=u}return s},n.Application=u=function(){function t(t){this.options=null!=t?t:{},this.urlRoot=this.options.urlRoot||"",this.contentType=this.options.contentType||"application/x-www-form-urlencoded",this.router=new n.Router(this.options.router),e.observable(this)}return t.prototype.start=function(){return this.container=this.mount(this.options.container),this.router.start()},t.prototype.mount=function(t){var r;return this.tags=this.tags||{},r=e.mount(t)[0],this.tags[t]=r,this.currentTag=r,r},t.prototype.mixin=function(t,r){var e,o,i;if(o=function(){},r.events){o=r.events.init||function(){},e=function(e){return t.on(e,r.events[e])};for(l in r.events)e(l)}return r.actions&&(r.actions.init=o,t.mixin(r.actions)),r.store?(i={},n.isString(r.store)?i.url=r.store:n.isObject(r.store)&&(i=r.store),t.store=new s(app,t,i)):void 0},t}(),d=/\((.*?)\)/g,g=/(\(\?)?:\w+/g,v=/\*\w+/g,p=/[\-{}\[\]+?.,\\\^$|#\s]/g,y=function(t){return t=t.replace(p,"\\$&").replace(d,"(?:$1)?").replace(g,function(t,r){return r?t:"([^/?]+)"}).replace(v,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},a=function(t,r){var e,n,o,i,s;for(i=t.exec(r).slice(1),s=[],e=0,n=i.length;n>e;e++)o=i[e],s.push(decodeURIComponent(o)||null);return s},m=function(t,r){var e,o,i,s,u,p,c;e=t.opts,c=e.routes,o=r.join("/"),u=[];for(i in c)p=y(i),p.test(o)&&u.push(n.isFunction(c[i])?c[i].apply(t,a(p,o)):null!=(s=e[c[i]])?s.apply(t,a(p,o)):void 0);return u},n.Router=i=function(){function r(t){this.opts=t}return r.prototype.start=function(){return e.route.exec(function(r){return function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],m(r,e)}}(this)),e.route(function(r){return function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],m(r,e)}}(this)),e.route.start()},r.prototype.stop=function(){return e.route.stop()},r.prototype.go=function(t){return e.route(t)},r.prototype.back=function(){return history.back()},r.prototype.add=function(t,r){return this.opts.routes[t]=r},r.prototype.remove=function(t){return delete this.opts.routes[t]},r}(),n.Adapter={Promise:{},ajax:{}},n.Store=s=function(){function t(t,r,e){this.app=t,this.tag=r,this.options=e,this.url=this.options.url,this.data=this.options.data||{},this.params=this.options.params||{},delete this.options.url,delete this.options.data,delete this.options.params}return t.prototype.get=function(t){return this.ajax({type:"GET",url:this.url},t,"geted")},t.prototype.post=function(t){return this.ajax({type:"POST",url:this.url},t,"posted")},t.prototype.put=function(t){return this.ajax({type:"PUT",url:this.url+"/"+t.id},t,"puted")},t.prototype.del=function(t){return this.ajax({type:"DELETE",url:this.url+"/"+t.id},t,"deleted")},t.prototype.save=function(t){return t.id?this.put(t):this.post(t)},t.prototype.ajax=function(t,r,e){var o,i,s,u;null==r&&(r={}),u=this,t.contentType=this.app.contentType,i=n.extend(t,this.options),i.url=this.app.urlRoot+i.url,o="";for(s in this.params)o+=s+"="+this.params[s]+"&";return""!==o&&(i.url+="?"+o.substring(0,o.length-1)),i.data=r,this.app.trigger("ajax",i),s=new n.Adapter.Promise,n.Adapter.ajax(i).done(function(t){return u.set(t),u.tag.trigger(e,t,"success"),this.app.trigger("ajaxed",t,"success"),"posted"===e&&u.tag.trigger("saved",t,"success"),s.resolve(t)}).fail(function(t){return u.tag.trigger(e,t,"error"),this.app.trigger("ajaxed",t,"error"),"posted"===e&&u.tag.trigger("saved",t,"error"),s.reject(t)}),s.promise()},t.prototype.set=function(t){return this.data=this.options.root?t[this.options.root]:t,this},t.prototype.clear=function(){return this.data={},this},t}(),o})}).call(this);