(function(){var t=[].slice;!function(t,r){var n;return"function"==typeof define&&define.amd?define(["riot"],function(n){return r(t,n)}):"object"==typeof exports?(n=require("riot"),module.exports=r(t,n)):t.Cheft=r(t,t.riot)}(window,function(r,n){var e,o,i,s,u,p,a,c,l,h,f,d,g,y,m,v,x,j;for(e=o={version:"1.0.0"},e.riot=n,x=Object.prototype.toString,j=["Function","Object","String","Array","Number","Boolean","Date","RegExp","Undefined","Null"],c=function(t){return e["is"+t]=function(r){return x.call(r)==="[object "+t+"]"}},l=0,f=j.length;f>l;l++)h=j[l],c(h);return e.extend=function(){var r,n,e,o,i,s,u;if(s=arguments[0],i=2<=arguments.length?t.call(arguments,1):[],!s)return s;for(r=0,e=i.length;e>r;r++){o=i[r];for(n in o)u=o[n],s[n]=u}return s},e.Application=u=function(){function t(t){this.options=null!=t?t:{},this.urlRoot=this.options.urlRoot||"",this.contentType=this.options.contentType||"application/x-www-form-urlencoded",this.router=new e.Router(this.options.router)}return t.prototype.start=function(){return this.container=this.mount(this.options.container),this.router.start()},t.prototype.mount=function(t){var r;return this.tags=this.tags||{},r=n.mount(t)[0],this.tags[t]=r,this.currentTag=r,r},t.prototype.mixin=function(t,r){var n,o,i;if(o=function(){},r.events){o=r.events.init||function(){},n=function(n){return t.on(n,r.events[n])};for(h in r.events)n(h)}return r.actions&&(r.actions.init=o,t.mixin(r.actions)),r.store?(i={},e.isString(r.store)?i.url=r.store:e.isObject(r.store)&&(i=r.store),t.store=new s(app,t,i)):void 0},t}(),g=/\((.*?)\)/g,d=/(\(\?)?:\w+/g,v=/\*\w+/g,p=/[\-{}\[\]+?.,\\\^$|#\s]/g,y=function(t){return t=t.replace(p,"\\$&").replace(g,"(?:$1)?").replace(d,function(t,r){return r?t:"([^/?]+)"}).replace(v,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},a=function(t,r){var n,e,o,i,s;for(i=t.exec(r).slice(1),s=[],n=0,e=i.length;e>n;n++)o=i[n],s.push(decodeURIComponent(o)||null);return s},m=function(t,r){var n,o,i,s,u,p,c;n=t.opts,c=n.routes,o=r.join("/"),u=[];for(i in c)p=y(i),p.test(o)&&u.push(e.isFunction(c[i])?c[i].apply(t,a(p,o)):null!=(s=n[c[i]])?s.apply(t,a(p,o)):void 0);return u},e.Router=i=function(){function r(t){this.opts=t}return r.prototype.start=function(){return n.route.exec(function(r){return function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],m(r,n)}}(this)),n.route(function(r){return function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],m(r,n)}}(this)),n.route.start()},r.prototype.stop=function(){return n.route.stop()},r.prototype.go=function(t){return n.route(t)},r.prototype.back=function(){return history.back()},r.prototype.add=function(t,r){return this.opts.routes[t]=r},r.prototype.remove=function(t){return delete this.opts.routes[t]},r}(),e.Adapter={Promise:{},ajax:{}},e.Store=s=function(){function t(t,r,n){this.app=t,this.tag=r,this.options=n,this.url=this.options.url,this.data=this.options.data||{},this.params=this.options.params||{},delete this.options.url,delete this.options.data,delete this.options.params}return t.prototype.get=function(t){return this.ajax({type:"GET",url:this.url},t,"geted")},t.prototype.post=function(t){return this.ajax({type:"POST",url:this.url},t,"posted")},t.prototype.put=function(t){return this.ajax({type:"PUT",url:this.url+"/"+t.id},t,"puted")},t.prototype.del=function(t){return this.ajax({type:"DELETE",url:this.url+"/"+t.id},t,"deleted")},t.prototype.save=function(t){return t.id?this.put(t):this.post(t)},t.prototype.ajax=function(t,r,n){var o,i,s,u;null==r&&(r={}),u=this,t.contentType=this.app.contentType,i=e.extend(t,this.options),i.url=this.app.urlRoot+i.url,o="";for(s in this.params)o+=s+"="+this.params[s]+"&";return""!==o&&(i.url+="?"+o.substring(0,o.length-1)),i.data=r,s=new e.Adapter.Promise,e.Adapter.ajax(i).done(function(t){return u.set(t),u.tag.trigger(n,t,"success"),"posted"===n&&u.tag.trigger("saved",t,"success"),s.resolve(t)}).fail(function(t){return u.tag.trigger(n,t,"error"),"posted"===n&&u.tag.trigger("saved",t,"error"),s.reject(t)}),s.promise()},t.prototype.set=function(t){return this.data=this.options.root?t[this.options.root]:t,this},t.prototype.clear=function(){return this.data={},this},t}(),o})}).call(this);