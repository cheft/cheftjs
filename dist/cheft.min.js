(function(){var t=[].slice;!function(t,n){var e;return"function"==typeof define&&define.amd?define(["riot"],function(e){return n(t,e)}):"object"==typeof exports?(e=require("riot"),module.exports=n(t,e)):t.Cheft=n(t,e)}(window,function(n,e){var r,u,o,i,s,a,c,p,f,l,h,d,g,m,y,x,v,j,S;for(r=o={version:"1.0.0"},l=0,j=Object.prototype.toString,S=["Function","Object","String","Array","Number","Boolean","Date","RegExp","Undefined","Null"],p=function(t){return r["is"+t]=function(n){return j.call(n)==="[object "+t+"]"}},f=0,d=S.length;d>f;f++)h=S[f],p(h);return r.extend=function(){var n,e,r,u,o,i,s;if(i=arguments[0],o=2<=arguments.length?t.call(arguments,1):[],!i)return i;for(n=0,r=o.length;r>n;n++){u=o[n];for(e in u)s=u[e],i[e]=s}return i},r.uniqueId=function(t){return(t?t:"")+ ++l},r.mixin=function(t,n){var e;if(n.actions&&t.mixin(n.actions),n.events){e=[];for(h in n.events)e.push(function(e){return t.on(e,n.events[e])}(h));return e}},r.Application=s=function(){function t(){}return t.prototype.mount=function(t){var n;return this.tags=this.tags||{},n=e.mount(t)[0],this.tags[t]=n,this.currentTag=n},t}(),m=/\((.*?)\)/g,g=/(\(\?)?:\w+/g,v=/\*\w+/g,a=/[\-{}\[\]+?.,\\\^$|#\s]/g,y=function(t){return t=t.replace(a,"\\$&").replace(m,"(?:$1)?").replace(g,function(t,n){return n?t:"([^/?]+)"}).replace(v,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},c=function(t,n){var e,r,u,o,i;for(o=t.exec(n).slice(1),i=[],e=0,r=o.length;r>e;e++)u=o[e],i.push(decodeURIComponent(u)||null);return i},x=function(t,n){var e,u,o,i,s,a,p;e=t.opts,p=e.routes,u=n.join("/"),s=[];for(o in p)a=y(o),a.test(u)&&s.push(r.isFunction(p[o])?p[o].apply(t,c(a,u)):null!=(i=e[p[o]])?i.apply(t,c(a,u)):void 0);return s},r.Router=i=function(){function n(t){this.opts=t}return n.prototype.start=function(){return e.route.exec(function(n){return function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],x(n,e)}}(this)),e.route(function(n){return function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],x(n,e)}}(this)),e.route.start()},n.prototype.stop=function(){return e.route.stop()},n.prototype.to=function(t){return e.route(t)},n.prototype.add=function(t,n){return this.opts.routes[t]=n},n.prototype.remove=function(t){return delete this.opts.routes[t]},n}(),r.Cache=u=function(){function t(t,n){this.key=t,this.session=n,this.cache=localStorage,this.session&&(this.cache=sessionStorage)}return t.prototype.get=function(){return JSON.parse(this.cache.getItem(this.key)||"[]")},t.prototype.save=function(t){return this.cache.setItem(this.key,JSON.stringify(t))},t}(),r.Adapter={Promise:null,ajax:null},r.Request={url:function(t){var n,e,r;for(e=t.app.options,r=[e.urlRoot],t.module.options.urlPrefix&&r.push(t.module.options.urlPrefix),r.push(t.module.name),n=t.url||"",D.isFunction(n)&&(n=n.apply(t));0===n.indexOf("../");)r.pop(),n=n.slice(3);return n&&r.push(n),t.data.id&&r.push(t.data.id),e.urlSuffix&&r.push(r.pop()+e.urlSuffix),compose.apply(null,r)},get:function(t,n){return this.ajax({type:"GET"},t,t.getParams(),n)},post:function(t,n){return this.ajax({type:"POST"},t,t.data,n)},put:function(t,n){return this.ajax({type:"PUT"},t,t.data,n)},del:function(t,n){return this.ajax({type:"DELETE"},t,t.data,n)},save:function(t,n){return t.data.id?this.put(t,n):this.post(t,n)},ajax:function(t,n,e,r){var u;return null==r&&(r={}),u=this.url(n),t=D.extend(t,r),e=D.extend(e,r.data),t.url=u,t.data=e,n.Promise.chain(A.ajax(t),function(t){return n.set(t),n.changed(),n})}},o})}).call(this);